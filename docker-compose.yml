version: "3"

services:
  emqx:
    image: emqx/emqx
    restart: unless-stopped
    labels:
      com.centurylinklabs.watchtower.enable: "false"
    ports:
      - 18083:18083
      - 1883:1883
      - 8083:8083
    networks:
      - backend

  foxlink-backend:
    build:
      context: .
      dockerfile: backend.Dockerfile
    tty: True
    env_file:
      - .env
    environment:
      MODULE_NAME: "app.server"
    restart: unless-stopped
    ports:
      - 8080:80
    depends_on:
      - emqx
      - mysql
    networks:
      - backend
    extra_hosts:
      - "host.docker.internal:host-gateway"

  mysql:
    # image: mysql:8
    image: mysql-test:test2
    restart: unless-stopped
    labels:
      com.centurylinklabs.watchtower.enable: "false"
    environment:
      MYSQL_DATABASE: foxlink
      MYSQL_ROOT_PASSWORD: AqqhQ993VNto
    ports:
      - 27001:3306
    # volumes:
    #   - mysql-storage:/var/lib/mysql
    networks:
      - backend

networks:
  backend:
    driver: bridge

volumes:
  mysql-storage:
